---
layout:     post
title:      程序员的自我修养学习笔记
subtitle:
date:       2022-1-27
author:     YC-Xiang
header-img:
catalog: true
tags:
    - 程序员的自我修养
---

# 第二部分 静态链接

## 第二章 编译和链接

### 2.1.1 **预编译：**

$gcc –E hello.c –o hello.i

- 展开宏定义
- 处理预编译指令 “#if”、“#ifdef”等等
- 处理 “#include ”预编译指令
- 删除注释
- 添加行号和文件名标识
- 保留所有的 #pragma 编译器指令

### 2.1.2 编译

编译：$gcc –S hello.i –o hello.s

预编译+编译：$gcc –S hello.c –o hello.s

汇编：$gcc –c hello.c –o hello.o

## 第三章 目标文件里有什么

### 3.1 目标文件的格式

- 可重定位文件 .o, .a
- 可执行文件
- 共享目标文件 .so
- 核心转储文件

`file` 命令可以查看文件格式

binutils的objdump工具查看obj内部的结构(隐藏的段不显示)：

objdump -h u-boot

readelf -S u-boot （把段表结构打印出来）

objdump -s -d u-boot

-s参数：将所有段内容以16进制方式打印出来

-d参数：将所有包含指令的段反汇编



size命令用来查看ELF文件的代码段、数据段、BSS段的长度

size u-boot



查看ELF文件头：

readelf -h u-boot



在全局变量或函数之前加上“__ attribute__((section(“name”))) ”属性就可以把相应的变量或函数放到以“ name ”作为段名的段中。

**attribute**((section("FOO"))) int global = 42;**attribute**((section("BAR"))) void foo()

# 第四章 静态连接

## 4.2 符号解析和重定位

### 4.2.2 重定位表

.text ⇒ .rel.text

.data ⇒ .rel.data

查看目标文件重定位表：objdump -r a.o

### 4.2.4 指令修正方式

- 绝对寻址修正
- 相对寻址修正

## 4.3 COMMON块

把未初始化的全局变量标记为一个COMMON类型的变量。

链接完成后，在最终输出文件的BSS段为其分配空间。