---
title: ICS_2022 PA1
date: 2023-01-010 16:47:28
tags:
- ICS
categories:
- Notes
---

```makefile
# nemu/scripts/native.mk

compile_git:
	$(call git_commit, "compile NEMU")
$(BINARY): compile_git

override ARGS ?= --log=$(BUILD_DIR)/nemu-log.txt
override ARGS += $(ARGS_DIFF) # nemu/tools/difftest.mk中CONFIG_DIFFTEST未定义，所以ARGS_DIFF不存在

IMG ?=

NEMU_EXEC := $(BINARY) $(ARGS) $(IMG)

run: run-env
	$(call git_commit, "run NEMU")
	$(NEMU_EXEC)

```

由makefile可知，输入`make run`启动nemu时，传递给`monitor.c parse_args(argc, argv)`的参数为`--log=$(BUILD_DIR)/nemu-log.txt`

```c
int main(int argc, char *argv[]) {
    init_monitor(argc, argv);
		parse_args(argc, argv);
  		init_rand();
  		init_log(log_file);
  		init_mem(); // 随机初始化内存
		init_isa();
			memcpy(guest_to_host(RESET_VECTOR), img, sizeof(img)); //加载内置客户程序
			restart(); // 初始化pc和0寄存器
  		long img_size = load_img();
		init_sdb();
		welcome();
  	engine_start();
 		sdb_mainloop();
  			str = rl_gets()); // 获取在(nemu)中输入的字符串
  			char *cmd = strtok(str, " "); //取字符串第一个空格前的为command
  			char *args = cmd + strlen(cmd) + 1; //
}
```
