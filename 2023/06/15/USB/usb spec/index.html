

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Yucheng Xiang">
  <meta name="keywords" content="">
  
    <meta name="description" content="QuestionsUSB-IF OthersUSB标准名称变更： USB 1.0 -&gt; USB 2.0 Low-Speed USB 1.1 -&gt; USB 2.0 Full-Speed USB 2.0 -&gt; USB 2.0 High-Speed USB 3.0 -&gt; USB 3.1 Gen1 -&gt; USB 3.2 Gen1 USB 3.1 -&gt; USB 3.1 G">
<meta property="og:type" content="article">
<meta property="og:title" content="usb spec">
<meta property="og:url" content="https://yc-xiang.github.io/2023/06/15/USB/usb%20spec/index.html">
<meta property="og:site_name" content="Yucheng&#39;s Blog">
<meta property="og:description" content="QuestionsUSB-IF OthersUSB标准名称变更： USB 1.0 -&gt; USB 2.0 Low-Speed USB 1.1 -&gt; USB 2.0 Full-Speed USB 2.0 -&gt; USB 2.0 High-Speed USB 3.0 -&gt; USB 3.1 Gen1 -&gt; USB 3.2 Gen1 USB 3.1 -&gt; USB 3.1 G">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230606134650.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607093420.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607094320.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607101850.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607103019.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607104959.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607105059.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607112911.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607112056.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607150914.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607150746.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607151058.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607153555.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607153606.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607163045.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230608111151.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230608112219.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230608113546.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230608114127.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230608114206.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230608135656.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230608142617.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230608141406.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230608142906.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230608145713.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230613155449.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230608145003.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230608145252.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230609174140.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230612145851.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230612152356.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230612152452.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230608170120.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230612110946.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230612111010.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230612155242.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230612160419.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230612160437.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230612160446.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230609173233.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230609173252.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230609173911.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230609173929.png">
<meta property="og:image" content="c:\Users\yucheng_xiang\AppData\Roaming\Typora\typora-user-images\image-20230609174005424.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230609174012.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230609174035.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230609174043.png">
<meta property="og:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230609174055.png">
<meta property="article:published_time" content="2023-06-15T09:38:28.000Z">
<meta property="article:modified_time" content="2023-09-05T07:28:26.922Z">
<meta property="article:author" content="Yucheng Xiang">
<meta property="article:tag" content="usb">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230606134650.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>usb spec - Yucheng&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"yc-xiang.github.io","root":"/","version":"1.9.4","typing":{"enable":false,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"C"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":"ed5b2440a3a7651272e4681ae4ac17e2","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  
    <!-- Baidu Analytics -->
    <script async>
      if (!Fluid.ctx.dnt) {
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?ed5b2440a3a7651272e4681ae4ac17e2";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
      }
    </script>
  

  

  

  

  

  

  



  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>YC&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/homepage.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle">usb spec</span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-06-15 17:38" pubdate>
          2023年6月15日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          5.9k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          49 mins
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> times
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">usb spec</h1>
            
              <p class="note note-info">
                
                  
                    本文最后更新于：2023年9月5日 下午
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <h1 id="Questions"><a href="#Questions" class="headerlink" title="Questions"></a>Questions</h1><p>USB-IF</p>
<h1 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h1><p>USB标准名称变更：</p>
<p>USB 1.0 -&gt; USB 2.0 Low-Speed</p>
<p>USB 1.1 -&gt; USB 2.0 Full-Speed</p>
<p>USB 2.0 -&gt; USB 2.0 High-Speed</p>
<p>USB 3.0 -&gt; USB 3.1 Gen1 -&gt; USB 3.2 Gen1</p>
<p>USB 3.1 -&gt; USB 3.1 Gen2 -&gt; USB 3.2 Gen2 × 1</p>
<p>USB 3.2 -&gt; USB 3.2 Gen2 × 2</p>
<p>USB OTG中增加了一种MINI USB接头，使用5条线，比标准USB多一条身份识别线。</p>
<p>USB协议规定，设备在未配置前，可以从Vbus最多获取100mA电流，配置之后，最多可以获得500mA电流。Vbus是5V的电压。</p>
<p>枚举就是从设备读取各种描述符信息。</p>
<p>Control transfer：低速8字节，高速64字节，全速8&#x2F;16&#x2F;32&#x2F;64字节。</p>
<p>Isochronous Transfer：全速1023字节，高速1024字节，低速不支持。</p>
<p>Interrupt Transfer：低速上限8字节，全速上限64字节，高速上限1024字节。</p>
<p>Bulk transfer：高速512字节，全速8&#x2F;16&#x2F;32&#x2F;64字节，低速不支持。</p>
<h1 id="Chapter3-Background"><a href="#Chapter3-Background" class="headerlink" title="Chapter3 Background"></a>Chapter3 Background</h1><p>USB 接口可用于连接多达 127 种外设。</p>
<h1 id="Chapter4-Architectural-Overview"><a href="#Chapter4-Architectural-Overview" class="headerlink" title="Chapter4 Architectural Overview"></a>Chapter4 Architectural Overview</h1><h3 id="4-1-1-Bus-Topology-总线拓扑"><a href="#4-1-1-Bus-Topology-总线拓扑" class="headerlink" title="4.1.1 Bus Topology 总线拓扑"></a>4.1.1 Bus Topology 总线拓扑</h3><p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230606134650.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>USB Host</li>
<li>USB Device<ul>
<li>Hub：用来扩展USB接口，最多接5层hub，如上图。</li>
<li>Function：USB设备。</li>
</ul>
</li>
</ul>
<h3 id="4-2-1-Electrical"><a href="#4-2-1-Electrical" class="headerlink" title="4.2.1 Electrical"></a>4.2.1 Electrical</h3><p>USB 2.0协议支持3种速率：</p>
<ul>
<li>低速(Low Speed，1.5Mbps)，兼容USB1.0</li>
<li>全速(Full Speed, 12Mbps)，兼容USB1.1</li>
<li>高速(High Speed, 480Mbps)</li>
</ul>
<p>USB 2.0 host controllers和hubs提供能力使<strong>full speed和low speed的数据</strong>能</p>
<p>以<strong>high speed</strong>的速率在<strong>host controller和hub</strong>之间传递，</p>
<p>以<strong>full speed和low speed</strong>的速率在<strong>hub和device</strong>之间传递。</p>
<h1 id="Chapter5-USB-Data-Flow-Model"><a href="#Chapter5-USB-Data-Flow-Model" class="headerlink" title="Chapter5 USB Data Flow Model"></a>Chapter5 USB Data Flow Model</h1><h3 id="5-3-1-Device-Endpoints"><a href="#5-3-1-Device-Endpoints" class="headerlink" title="5.3.1 Device Endpoints"></a>5.3.1 Device Endpoints</h3><p>Endpoint 只支持一种方向的数据流通，input or output。除endpoint0，input+output。</p>
<p>endpoint 描述的内容有：</p>
<ul>
<li>总线访问频率&#x2F;延迟要求</li>
<li>带宽要求</li>
<li>endpoint number</li>
<li>Error handling</li>
<li>最大的packet size</li>
<li>数据传输方向</li>
</ul>
<h3 id="5-3-2-Pipes"><a href="#5-3-2-Pipes" class="headerlink" title="5.3.2 Pipes"></a>5.3.2 Pipes</h3><ul>
<li><p>Stream</p>
<p>传输的data没有USB-defined structure</p>
</li>
<li><p>Message</p>
<p>传输的data有USB-defined structure</p>
</li>
</ul>
<h1 id="Chapter7-Electrical"><a href="#Chapter7-Electrical" class="headerlink" title="Chapter7 Electrical"></a>Chapter7 Electrical</h1><h2 id="7-1-Signaling"><a href="#7-1-Signaling" class="headerlink" title="7.1 Signaling"></a>7.1 Signaling</h2><p>High Speed电路图。</p>
<p>Hub D+, D-信号线上有右下两个15k Rpd下拉电阻，所以默认电平为0。</p>
<p>device D+信号线上有1.5k Rpu上拉电阻，接上后D+被拉高。运行后会被Rpu_enable移除。</p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607093420.png" srcset="/img/loading.gif" lazyload></p>
<p>Spec Table 7.1对各元器件功能有详细解释。</p>
<p>高速设备D+, D-各有Rs 45Ω的下拉电阻，用来消除反射信号：</p>
<p>当断开高速设备后，Hub发出信号，得到的反射信号无法衰减，Hub监测到这些信号后就知道高速设备已经断开。对应上图的Rs和Disconnection Envelope Detector。当差分信号线的幅值超过<strong>625mV</strong>，意味着断开。</p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607094320.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="7-1-5-1-Low-x2F-Full-speed-Device-Speed-Identification"><a href="#7-1-5-1-Low-x2F-Full-speed-Device-Speed-Identification" class="headerlink" title="7.1.5.1 Low-&#x2F;Full-speed Device Speed Identification"></a>7.1.5.1 Low-&#x2F;Full-speed Device Speed Identification</h4><p>Full&#x2F;High-speed device D+ 上有1.5k Rpu上拉。</p>
<p>Low-speed device D- 上有1.5k Rpu上拉。</p>
<p>用于attach时区分不同速率的设备。</p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607101850.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="7-1-7-Signaling-levels"><a href="#7-1-7-Signaling-levels" class="headerlink" title="7.1.7 Signaling levels"></a>7.1.7 Signaling levels</h3><h4 id="7-1-7-1-Low-x2F-Full-speed-Signaling-Levels"><a href="#7-1-7-1-Low-x2F-Full-speed-Signaling-Levels" class="headerlink" title="7.1.7.1 Low-&#x2F;Full-speed Signaling Levels"></a>7.1.7.1 Low-&#x2F;Full-speed Signaling Levels</h4><p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607103019.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="7-1-7-2-High-speed-Signaling-Levels"><a href="#7-1-7-2-High-speed-Signaling-Levels" class="headerlink" title="7.1.7.2 High-speed Signaling Levels"></a>7.1.7.2 High-speed Signaling Levels</h4><p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607104959.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607105059.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="7-1-7-4-Data-Signaling"><a href="#7-1-7-4-Data-Signaling" class="headerlink" title="7.1.7.4 Data Signaling"></a>7.1.7.4 Data Signaling</h4><h5 id="7-1-7-4-1-Low-x2F-Full-Speed-Signaling"><a href="#7-1-7-4-1-Low-x2F-Full-Speed-Signaling" class="headerlink" title="7.1.7.4.1 Low-&#x2F;Full-Speed Signaling"></a>7.1.7.4.1 Low-&#x2F;Full-Speed Signaling</h5><p>SOP：Start Of Packet，Hub驱动D+、D-这两条线路从Idle状态变为K状态。SOP中的K状态就是SYNC信号的第1位数据，SYNC格式为3对KJ外加2个K。</p>
<p>EOP：End Of Packet，由数据的发送方发出EOP，数据发送方驱动D+、D-这两条线路，先设为SE0状态并维持2位时间，再设置为J状态并维持1位时间，最后D+、D-变为高阻状态，这时由线路的上下拉电阻使得总线进入Idle状态。</p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607112911.png" srcset="/img/loading.gif" lazyload></p>
<h5 id="7-1-7-4-2-High-speed-Signaling"><a href="#7-1-7-4-2-High-speed-Signaling" class="headerlink" title="7.1.7.4.2 High-speed Signaling"></a>7.1.7.4.2 High-speed Signaling</h5><h4 id="7-1-7-5-Reset"><a href="#7-1-7-5-Reset" class="headerlink" title="7.1.7.5 Reset"></a>7.1.7.5 Reset</h4><h4 id="7-1-7-6-Suspend"><a href="#7-1-7-6-Suspend" class="headerlink" title="7.1.7.6 Suspend"></a>7.1.7.6 Suspend</h4><h4 id="7-1-7-7-Resume"><a href="#7-1-7-7-Resume" class="headerlink" title="7.1.7.7 Resume"></a>7.1.7.7 Resume</h4><h3 id="7-1-8-Data-encoding-数据编码"><a href="#7-1-8-Data-encoding-数据编码" class="headerlink" title="7.1.8 Data encoding 数据编码"></a>7.1.8 Data encoding 数据编码</h3><p>NRZI编码，电平信号不变表示1，跳变表示0。</p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607112056.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="7-1-9-Bit-Stuffing-位填充"><a href="#7-1-9-Bit-Stuffing-位填充" class="headerlink" title="7.1.9 Bit Stuffing 位填充"></a>7.1.9 Bit Stuffing 位填充</h3><p>连续传送6个1后，会填充一个0强制翻转信号。</p>
<h1 id="Chapter8-Protocol-Layer"><a href="#Chapter8-Protocol-Layer" class="headerlink" title="Chapter8 Protocol Layer"></a>Chapter8 Protocol Layer</h1><h2 id="8-2-SYNC-field"><a href="#8-2-SYNC-field" class="headerlink" title="8.2 SYNC field"></a>8.2 SYNC field</h2><p>对于低速&#x2F;全速设备，SYNC信号是8位数据(从做到右是00000001)；对于高速设备，SYNC信号是32位数据(从左到右是00000000000000000000000000000001)。使用NRZI编码时，前面每个”0”都对应一个跳变。</p>
<p>同步域这样可以用来同步主机端和设备端的数据时钟。</p>
<h2 id="8-3-Packet-Field-Formats"><a href="#8-3-Packet-Field-Formats" class="headerlink" title="8.3 Packet Field Formats"></a>8.3 Packet Field Formats</h2><p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607150914.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="8-3-1-PID"><a href="#8-3-1-PID" class="headerlink" title="8.3.1 PID"></a>8.3.1 PID</h3><p>PID表示了包的类型。</p>
<p>PID后四位为前四位的取反。</p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607150746.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607151058.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="8-3-2-Address-fields"><a href="#8-3-2-Address-fields" class="headerlink" title="8.3.2 Address fields"></a>8.3.2 Address fields</h3><h4 id="8-3-2-1-Address-Field"><a href="#8-3-2-1-Address-Field" class="headerlink" title="8.3.2.1 Address Field"></a>8.3.2.1 Address Field</h4><p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607153555.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="8-3-2-2-Endpoint-Field"><a href="#8-3-2-2-Endpoint-Field" class="headerlink" title="8.3.2.2 Endpoint Field"></a>8.3.2.2 Endpoint Field</h4><p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607153606.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="8-3-3-Frame-Number-Field"><a href="#8-3-3-Frame-Number-Field" class="headerlink" title="8.3.3 Frame Number Field"></a>8.3.3 Frame Number Field</h3><p>11 bits。</p>
<h3 id="8-3-4-Data-Field"><a href="#8-3-4-Data-Field" class="headerlink" title="8.3.4 Data Field"></a>8.3.4 Data Field</h3><p>0-1024 bytes。</p>
<h2 id="8-4-Packet-Formats"><a href="#8-4-Packet-Formats" class="headerlink" title="8.4 Packet Formats"></a>8.4 Packet Formats</h2><h3 id="8-4-1-Token-Packets"><a href="#8-4-1-Token-Packets" class="headerlink" title="8.4.1 Token Packets"></a>8.4.1 Token Packets</h3><ul>
<li>OUT<ul>
<li>通知设备将要输出一个数据包。</li>
</ul>
</li>
<li>IN<ul>
<li>通知设备返回一个数据包。</li>
</ul>
</li>
<li>SETUP<ul>
<li>只用于控制传输，跟OUT令牌包作用一样，通知设备将要输出一个数据包。区别在于SETUP后只使用DATA0数据包，且只能发送到设备的endpoint，并且设备必须接收。</li>
</ul>
</li>
</ul>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230607163045.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="8-4-3-SOF-packets"><a href="#8-4-3-SOF-packets" class="headerlink" title="8.4.3 SOF packets"></a>8.4.3 SOF packets</h3><ul>
<li>SOF<ul>
<li>以广播的形式发送，所有USB全速设备和高速设备都可以收到SOF包。host在full-speed bus每ms产生一个帧，在high-speed bus每125us产生一个微帧。USB主机会对当前帧号进行计数，在每次帧开始时（或者微帧开始时，每毫秒有8个微帧，这8个微帧的帧号是相同的，即相同的SOF）。</li>
</ul>
</li>
</ul>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230608111151.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="8-4-4-Data-Packets"><a href="#8-4-4-Data-Packets" class="headerlink" title="8.4.4 Data Packets"></a>8.4.4 Data Packets</h3><p>low-speed 最大8bytes。</p>
<p>full-speed 最大1023bytes。</p>
<p>high-speed 最大1024bytes。</p>
<h3 id="8-4-5-Handshake-Packets"><a href="#8-4-5-Handshake-Packets" class="headerlink" title="8.4.5 Handshake Packets"></a>8.4.5 Handshake Packets</h3><p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230608112219.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li><p>ACK</p>
<p>表示正确接受数据，并且有足够空间来容纳数据。主机和设备都可以用ACK来确认。而NAK, STALL, NYET只有设备能够返回。</p>
</li>
<li><p>NAK</p>
<p>表示设备无法从主机端接收数据，或者设备没有数据返回给主机。</p>
</li>
<li><p>STALL</p>
<p>表示设备无法执行这个请求，或者端点已经被挂起了，表示一种错误的状态。如果端点的Halt feature被设置了，会返回STALL。</p>
</li>
<li><p>NYET</p>
<p>只在high-speed输出事务中使用，表示设备本次数据成功接收，但是没有足够空间来接收下一次数据。主机在下一次输出数据时，将先使用PING令牌包来试探设备是否有足够空间接收数据。</p>
</li>
</ul>
<h3 id="8-4-6-Handshake-Response"><a href="#8-4-6-Handshake-Response" class="headerlink" title="8.4.6 Handshake Response"></a>8.4.6 Handshake Response</h3><h4 id="8-4-6-1-Function-Response-to-IN-Transactions"><a href="#8-4-6-1-Function-Response-to-IN-Transactions" class="headerlink" title="8.4.6.1 Function Response to IN Transactions"></a>8.4.6.1 Function Response to IN Transactions</h4><p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230608113546.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="8-4-6-2-Host-Response-to-IN-Transactions"><a href="#8-4-6-2-Host-Response-to-IN-Transactions" class="headerlink" title="8.4.6.2 Host Response to IN Transactions"></a>8.4.6.2 Host Response to IN Transactions</h4><p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230608114127.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="8-4-6-3-Function-Response-to-an-OUT-Transaction"><a href="#8-4-6-3-Function-Response-to-an-OUT-Transaction" class="headerlink" title="8.4.6.3 Function Response to an OUT Transaction"></a>8.4.6.3 Function Response to an OUT Transaction</h4><p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230608114206.png" srcset="/img/loading.gif" lazyload></p>
<p>第三行对应If the transaction is maintaining sequence bit synchronization and a mismatch is detected (refer to Section 8.6 for details), then the function returns ACK and discards the data。</p>
<h3 id="8-5-2-Bulk-Transactions"><a href="#8-5-2-Bulk-Transactions" class="headerlink" title="8.5.2 Bulk Transactions"></a>8.5.2 Bulk Transactions</h3><p><strong>BULK IN:</strong></p>
<p>host端发送IN令牌包，device回应data或者NAK, STALL。NAK表示目前无法返回data，STALL表示endpoint已经被挂起了。</p>
<p>如果host端成功收到data，会回一个ACK握手包。如果有错误，不会返回握手包。 </p>
<p><strong>BULK OUT:</strong></p>
<p>host端发送OUT令牌包，紧接着data包或者PING包。</p>
<p>如果device端正确收到data，可能会回四种握手包：</p>
<ul>
<li><p>ACK: 数据正确，通知host可以发送下一个包。</p>
</li>
<li><p>NAK: 数据正确，但通知host需要重新发送数据，因为device端没能接收成功(比如 buffer full)。</p>
</li>
<li><p>STALL: endpoint挂起。</p>
</li>
<li><p>NYET: 只在high speed中存在。</p>
</li>
</ul>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230608135656.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230608142617.png" srcset="/img/loading.gif" lazyload></p>
<p>数据包类型在DATA0和DATA1之间切换。</p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230608141406.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="8-5-3-Control-Transfer"><a href="#8-5-3-Control-Transfer" class="headerlink" title="8.5.3 Control Transfer"></a>8.5.3 Control Transfer</h3><p>Control 是transfer而不是transaction的原因是，control transfer由多个事务(transaction)组成。包括SETUP stage（SETUP事务），data stage（1个或者多个IN&#x2F;OUT事务），status stage（1个IN事务）。Data Stage是可选的。</p>
<p>而Bulk&#x2F;interrupt&#x2F;isochronous transfer都是由对应的单独一个Bulk&#x2F;interrupt&#x2F;isochronous transaction组成。</p>
<p>下图为SETUP事务流程，Setup Stage必须是DATA0。如果device端正确收到SETUP data, 回复ACK握手包。如果数据错误丢弃数据并且不发送握手包。</p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230608142906.png" srcset="/img/loading.gif" lazyload></p>
<p>对应下图的<strong>Setup Stage</strong>。</p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230608145713.png" srcset="/img/loading.gif" lazyload></p>
<p><strong>Data stage</strong>：由一个或多个IN or OUT事务组成，和bulk transfer相同。</p>
<p><strong>Status stage</strong>：始终使用DATA1包，方向与前一个stage相反(如果没有data stage，则为IN)。见上图。</p>
<h4 id="8-5-3-1-Reporting-Status-Results"><a href="#8-5-3-1-Reporting-Status-Results" class="headerlink" title="8.5.3.1 Reporting Status Results"></a>8.5.3.1 Reporting Status Results</h4><p>status stage返回host Setup和Data stage的结果。</p>
<p>Control write在status stage的data phase返回status信息。</p>
<p>Control read在status stage的handshake phase返回status信息。</p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230613155449.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="8-5-4-Interrupt-Transactions"><a href="#8-5-4-Interrupt-Transactions" class="headerlink" title="8.5.4 Interrupt Transactions"></a>8.5.4 Interrupt Transactions</h3><p>和bulk transaction区别是没有PING和NYET两个包，interrupt 是周期性地发起传输。而不是传统的设备发出中断请求，cpu处理中断。所以USB的中断实际意义是实时查询操作。</p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230608145003.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="8-5-5-Isochronous-Transactions"><a href="#8-5-5-Isochronous-Transactions" class="headerlink" title="8.5.5 Isochronous Transactions"></a>8.5.5 Isochronous Transactions</h3><p>没有handshake阶段。</p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230608145252.png" srcset="/img/loading.gif" lazyload></p>
<h1 id="Chapter9-Device-Framework"><a href="#Chapter9-Device-Framework" class="headerlink" title="Chapter9 Device Framework"></a>Chapter9 Device Framework</h1><p>USB的状态切换图：</p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230609174140.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="9-3-USB-Device-Requests"><a href="#9-3-USB-Device-Requests" class="headerlink" title="9.3 USB Device Requests"></a>9.3 USB Device Requests</h2><p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230612145851.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li><p>bmRequestType：区分方向，type，device&#x2F;interface&#x2F;endpoint。</p>
</li>
<li><p>bRequest: 具体的事件，只定义了bmRequestType D[6:5]为Standard的情况。</p>
</li>
<li><p>wValue: 传递一些需要的值。</p>
</li>
<li><p>wIndex: 分为endpoint和interface，两种的wIndex不同。</p>
</li>
</ul>
<p><strong>endpoint:</strong></p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230612152356.png" srcset="/img/loading.gif" lazyload></p>
<p>D7: 0:OUT 1:IN 在control pipe中direction应该被设为0，即OUT事件。但device可以接收0或1。</p>
<p><strong>interface:</strong></p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230612152452.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li><p>wLength: control transfer第二段传递data0的字节数。如果wLength为0, 不需要传递数据，没有数据传输的阶段（注意这里的数据传输阶段是control transfer 中data0那段，是SETUP stage中那段）。</p>
<p>INPUT request wLength不能超过wLength字节数，可以比wLength少。</p>
<p>OUTPUT request wLength正确表示host传递给device的字节数。</p>
</li>
</ul>
<h2 id="9-4-Standard-Device-Requests"><a href="#9-4-Standard-Device-Requests" class="headerlink" title="9.4 Standard Device Requests"></a>9.4 Standard Device Requests</h2><p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230608170120.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230612110946.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230612111010.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230612155242.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="9-4-1-Clear-Feature"><a href="#9-4-1-Clear-Feature" class="headerlink" title="9.4.1 Clear Feature"></a>9.4.1 Clear Feature</h3><p>在Address state下合法。Recipient为device or ep0合法，看Table9-6。</p>
<p>Test_Mode feature 不能被ClearFeature()清除。</p>
<h3 id="9-4-2-Get-configuration"><a href="#9-4-2-Get-configuration" class="headerlink" title="9.4.2 Get configuration"></a>9.4.2 Get configuration</h3><h3 id="9-4-3-Get-Descriptor"><a href="#9-4-3-Get-Descriptor" class="headerlink" title="9.4.3 Get Descriptor"></a>9.4.3 Get Descriptor</h3><p>wValue high byte是描述符的类型，具体参考Table9-5. </p>
<p>low byte是index</p>
<h3 id="9-4-5-Get-Status"><a href="#9-4-5-Get-Status" class="headerlink" title="9.4.5 Get Status"></a>9.4.5 Get Status</h3><p>bmRequestType为Device，device返回的信息。</p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230612160419.png" srcset="/img/loading.gif" lazyload></p>
<p>bmRequestType为Interface，status为0。</p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230612160437.png" srcset="/img/loading.gif" lazyload></p>
<p>bmRequestType为endpoint，返回是否halt。</p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230612160446.png" srcset="/img/loading.gif" lazyload></p>
<p>所有interrupt和bulk endpoints都要实现Halt feature。</p>
<p>Default control pipe，即ep0 in and ep0 out，不需要也不推荐实现Halt feature。</p>
<h3 id="9-4-6-Set-Address"><a href="#9-4-6-Set-Address" class="headerlink" title="9.4.6 Set Address"></a>9.4.6 Set Address</h3><p>Default stage: 传递的地址不为0则进入Address stage， 为0则保持在Default stage。</p>
<p>Address stage: 传递的地址为0则进入Default stage，不为0则保持在Address stage，并更换新的地址。</p>
<p>地址不能超过127。</p>
<h3 id="9-4-7-Set-Configuration"><a href="#9-4-7-Set-Configuration" class="headerlink" title="9.4.7 Set Configuration"></a>9.4.7 Set Configuration</h3><h2 id="9-6-Standard-USB-Descriptor-Definitions"><a href="#9-6-Standard-USB-Descriptor-Definitions" class="headerlink" title="9.6 Standard USB Descriptor Definitions"></a>9.6 Standard USB Descriptor Definitions</h2><h3 id="9-6-1-Device-设备描述符"><a href="#9-6-1-Device-设备描述符" class="headerlink" title="9.6.1 Device 设备描述符"></a>9.6.1 Device 设备描述符</h3><p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230609173233.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230609173252.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="9-6-2-Device-qualifer"><a href="#9-6-2-Device-qualifer" class="headerlink" title="9.6.2 Device_qualifer"></a>9.6.2 Device_qualifer</h3><h3 id="9-6-3-Configuration-配置描述符"><a href="#9-6-3-Configuration-配置描述符" class="headerlink" title="9.6.3 Configuration 配置描述符"></a>9.6.3 Configuration 配置描述符</h3><p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230609173911.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230609173929.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="9-6-5-Interface-接口描述符"><a href="#9-6-5-Interface-接口描述符" class="headerlink" title="9.6.5 Interface 接口描述符"></a>9.6.5 Interface 接口描述符</h3><p>接口对应一种function。</p>
<p><img src="C:\Users\yucheng_xiang\AppData\Roaming\Typora\typora-user-images\image-20230609174005424.png" srcset="/img/loading.gif" lazyload alt="image-20230609174005424"></p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230609174012.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="9-6-6-Endpoint-端点描述符"><a href="#9-6-6-Endpoint-端点描述符" class="headerlink" title="9.6.6 Endpoint 端点描述符"></a>9.6.6 Endpoint 端点描述符</h3><p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230609174035.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230609174043.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://xyc-1316422823.cos.ap-shanghai.myqcloud.com/20230609174055.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="9-6-7-String-字符串描述符"><a href="#9-6-7-String-字符串描述符" class="headerlink" title="9.6.7 String 字符串描述符"></a>9.6.7 String 字符串描述符</h3>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/usb/" class="category-chain-item">usb</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/usb/">#usb</a>
      
    </div>
  
</div>


              

              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/06/15/USB/usb%20driver/" title="linux usb driver">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">linux usb driver</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/05/26/rCore_uCore/Lookup/" title="risc-v Lookup">
                        <span class="hidden-mobile">risc-v Lookup</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>





  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
